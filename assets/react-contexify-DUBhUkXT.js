import{r as m,R as S}from"./react-CWupyEIp.js";import{c as M}from"./clsx-CH7BE6MN.js";import{r as I}from"./react-dom-VCwjLMmb.js";var Y=m.createContext({}),W=()=>m.useContext(Y),X=t=>S.createElement(Y.Provider,{...t});function G(){let t=new Map;return{on(e,n){return t.has(e)?t.get(e).add(n):t.set(e,new Set([n])),this},off(e,n){return t.has(e)&&t.get(e).delete(n),this},emit(e,n){return t.has(e)&&t.get(e).forEach(d=>{d(n)}),this}}}var N=G(),J=()=>m.useRef(new Map).current,j=()=>{},U=["resize","contextmenu","click","scroll","blur"],O={show({event:t,id:e,props:n,position:d}){t.preventDefault&&t.preventDefault(),N.emit(0).emit(e,{event:t.nativeEvent||t,props:n,position:d})},hideAll(){N.emit(0)}};function ie(t){return{show(e){O.show({...t,...e})},hideAll(){O.hideAll()}}}function q(){let t=new Map,e,n,d,a,r=!1;function L(i){a=Array.from(i.values()),e=-1,d=!0}function y(){a[e].node.focus()}let g=()=>e>=0&&a[e].isSubmenu,T=()=>Array.from(a[e].submenuRefTracker.values());function c(){return e===-1?(b(),!1):!0}function b(){e+1<a.length?e++:e+1===a.length&&(e=0),r&&u(),y()}function x(){e===-1||e===0?e=a.length-1:e-1<a.length&&e--,r&&u(),y()}function h(){if(c()&&g()){let i=T(),{node:f,setSubmenuPosition:w}=a[e];return t.set(f,{isRoot:d,focusedIndex:e,parentNode:n||f,items:a}),w(),f.classList.add("contexify_submenu-isOpen"),n=f,i.length>0?(e=0,a=i):r=!0,d=!1,y(),!0}return!1}function u(){if(c()&&!d){let i=t.get(n);n.classList.remove("contexify_submenu-isOpen"),a=i.items,n=i.parentNode,i.isRoot&&(d=!0,t.clear()),r||(e=i.focusedIndex,y())}}function E(i){function f(w){for(let v of w)v.isSubmenu&&v.submenuRefTracker&&f(Array.from(v.submenuRefTracker.values())),v.keyMatcher&&v.keyMatcher(i)}f(a)}return{init:L,moveDown:b,moveUp:x,openSubmenu:h,closeSubmenu:u,matchKeys:E}}function $(t){return typeof t=="function"}function B(t){return typeof t=="string"}function Q(t,e){return m.Children.map(m.Children.toArray(t).filter(Boolean),n=>m.cloneElement(n,e))}function Z(t){let e={x:t.clientX,y:t.clientY},n=t.changedTouches;return n&&(e.x=n[0].clientX,e.y=n[0].clientY),(!e.x||e.x<0)&&(e.x=0),(!e.y||e.y<0)&&(e.y=0),e}function P(t,e){return $(t)?t(e):t}function ee(t,e){return{...t,...$(e)?e(t):e}}var oe=({id:t,theme:e,style:n,className:d,children:a,animation:r="fade",preventDefaultOnKeydown:L=!0,disableBoundariesCheck:y=!1,onVisibilityChange:g,...T})=>{let[c,b]=m.useReducer(ee,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),x=m.useRef(null),h=J(),[u]=m.useState(()=>q()),E=m.useRef(),i=m.useRef();m.useEffect(()=>(N.on(t,w).on(0,v),()=>{N.off(t,w).off(0,v)}),[t,r,y]),m.useEffect(()=>{c.visible?u.init(h):h.clear()},[c.visible,u,h]);function f(s,p){if(x.current&&!y){let{innerWidth:l,innerHeight:A}=window,{offsetWidth:D,offsetHeight:F}=x.current;s+D>l&&(s-=s+D-l),p+F>A&&(p-=p+F-A)}return{x:s,y:p}}m.useEffect(()=>{c.visible&&b(f(c.x,c.y))},[c.visible]),m.useEffect(()=>{function s(l){L&&l.preventDefault()}function p(l){switch(l.key){case"Enter":case" ":u.openSubmenu()||v();break;case"Escape":v();break;case"ArrowUp":s(l),u.moveUp();break;case"ArrowDown":s(l),u.moveDown();break;case"ArrowRight":s(l),u.openSubmenu();break;case"ArrowLeft":s(l),u.closeSubmenu();break;default:u.matchKeys(l);break}}if(c.visible){window.addEventListener("keydown",p);for(let l of U)window.addEventListener(l,v)}return()=>{window.removeEventListener("keydown",p);for(let l of U)window.removeEventListener(l,v)}},[c.visible,u,L]);function w({event:s,props:p,position:l}){s.stopPropagation();let A=l||Z(s),{x:D,y:F}=f(A.x,A.y);I.flushSync(()=>{b({visible:!0,willLeave:!1,x:D,y:F,triggerEvent:s,propsFromTrigger:p})}),clearTimeout(i.current),!E.current&&$(g)&&(g(!0),E.current=!0)}function v(s){s!=null&&(s.button===2||s.ctrlKey)&&s.type!=="contextmenu"||(r&&(B(r)||"exit"in r&&r.exit)?b(p=>({willLeave:p.visible})):b(p=>({visible:p.visible?!1:p.visible})),i.current=setTimeout(()=>{$(g)&&g(!1),E.current=!1}))}function _(){c.willLeave&&c.visible&&I.flushSync(()=>b({visible:!1,willLeave:!1}))}function K(){return B(r)?M({[`contexify_willEnter-${r}`]:k&&!C,[`contexify_willLeave-${r} contexify_willLeave-'disabled'`]:k&&C}):r&&"enter"in r&&"exit"in r?M({[`contexify_willEnter-${r.enter}`]:r.enter&&k&&!C,[`contexify_willLeave-${r.exit} contexify_willLeave-'disabled'`]:r.exit&&k&&C}):null}let{visible:k,triggerEvent:o,propsFromTrigger:R,x:z,y:H,willLeave:C}=c,V=M("contexify",d,{[`contexify_theme-${e}`]:e},K());return S.createElement(X,{value:h},k&&S.createElement("div",{...T,className:V,onAnimationEnd:_,style:{...n,left:z,top:H,opacity:1},ref:x,role:"menu"},Q(a,{propsFromTrigger:R,triggerEvent:o})))},se=({id:t,children:e,className:n,style:d,triggerEvent:a,data:r,propsFromTrigger:L,keyMatcher:y,onClick:g=j,disabled:T=!1,hidden:c=!1,closeOnClick:b=!0,handlerEvent:x="onClick",...h})=>{let u=m.useRef(),E=W(),i={id:t,data:r,triggerEvent:a,props:L},f=P(T,i),w=P(c,i);function v(o){i.event=o,o.stopPropagation(),f||(b?_():g(i))}function _(){let o=u.current;o.focus(),o.addEventListener("animationend",()=>setTimeout(O.hideAll),{once:!0}),o.classList.add("contexify_item-feedback"),g(i)}function K(o){o&&!f&&(u.current=o,E.set(o,{node:o,isSubmenu:!1,keyMatcher:!f&&$(y)&&(R=>{y(R)&&(R.stopPropagation(),R.preventDefault(),i.event=R,_())})}))}function k(o){(o.key==="Enter"||o.key===" ")&&(o.stopPropagation(),i.event=o,_())}return w?null:S.createElement("div",{...h,[x]:v,className:M("contexify_item",n,{"contexify_item-disabled":f}),style:d,onKeyDown:k,ref:K,tabIndex:-1,role:"menuitem","aria-disabled":f},S.createElement("div",{className:"contexify_itemContent"},e))},ae=({triggerEvent:t,data:e,propsFromTrigger:n,hidden:d=!1})=>P(d,{data:e,triggerEvent:t,props:n})?null:S.createElement("div",{className:"contexify_separator"});export{ae as E,ie as F,oe as i,se as p};
